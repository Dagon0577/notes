# 学习内容 2019-05-14
- [df 磁盘空间使用 inode使用](#磁盘空间使用)
- [sar 查看历史统计性能信息 网络丢包情况等](#查看历史统计性能信息)
- [ps kill 进程管理](#进程管理)
- [vmstat 查看上下文切换](#查看上下文切换)
- [ifconfig ip 查看IP信息](#查看IP信息)
- [route ip 查看路由信息](#查看路由信息)
- [ping telnet 是否能通](#ping/telnet)
---
## 磁盘空间使用
- **df命令：**
    - **命令格式：**

    >`# df [选项] [文件]`

    - **命令功能：**

    显示指定磁盘文件的可用空间。如果没有文件名被指定，则所有当前被挂载的文件系统的可用空间将被显示。默认情况下，磁盘空间将以 1KB 为单位进行显示，除非环境变量 POSIXLY_CORRECT 被指定，那样将以512字节为单位进行显示
    
    - **命令参数：**

        -a 全部文件系统列表

        -h 方便阅读方式显示

        -H 等于“-h”，但是计算式，1K=1000，而不是1K=1024

        -i 显示inode信息

        -k 区块为1024字节

        -l 只显示本地文件系统

        -m 区块为1048576字节

        --no-sync 忽略 sync 命令

        -P 输出格式为POSIX

        --sync 在取得磁盘信息前，先执行sync命令

        -T 文件系统类型

        选择参数：

        --block-size=<区块大小> 指定区块大小

        -t<文件系统类型> 只显示选定文件系统的磁盘信息

        -x<文件系统类型> 不显示选定文件系统的磁盘信息

        --help 显示帮助信息

        --version 显示版本信息
    
    - 1、显示磁盘使用情况：
    >`# df`

    - 2、以inode模式来显示磁盘使用情况
    >`# df -i`

    - 3、显示指定类型磁盘
    >`# df -t xfs`

    - 4、列出各文件系统的i节点使用情况
    >`# df -ia`

    - 5、列出文件系统的类型
    >`# df -T`

    - 6、以更易读的方式显示目前磁盘空间和使用情况
    >`# df -h`

## 查看历史统计性能信息
- **sar命令：**  
可以从文件的读写情况、系统调用的使用情况、磁盘I/O、CPU效率、内存使用状况、进程活动及IPC有关的活动等方面进行报告。

    - **命令格式：**
    >`# sar [OPTIONS][-A][-o file] t [n]`

        t为采样间隔，n为采样次数，默认值是1
        -o file表示将命令结果以二进制格式存放在文件中，file 是文件名。
        options 为命令行选项


    - **命令参数：**  
    -A：所有报告的总和  
    -u：输出CPU使用情况的统计信息  
    -v：输出inode、文件和其他内核表的统计信息  
    -d：输出每一个块设备的活动信息  
    -r：输出内存和交换空间的统计信息  
    -b：显示I/O和传送速率的统计信息  
    -a：文件读写情况  
    -c：输出进程统计信息，每秒创建的进程数  
    -R：输出内存页面的统计信息  
    -y：终端设备活动情况  
    -w：输出系统交换活动信息


    - **CPU资源监控**：  
    >`# sar -u -o test_sar 5 10`

        每5s采样一次，连续采样10次，观察cpu使用情况，并将采样结果以二进制形式存入test_sar中（查看二进制文件test中的内容，sar命令：sar -u -f test_sar）
    
    **输出项说明：**

    CPU：all表示统计信息为所有 CPU的平均值。

    %user：显示在用户级别(application)运行使用 CPU 总时间的百分比。

    %nice：显示在用户级别，用于nice操作，所占用 CPU总时间的百分比。

    %system：在核心级别(kernel)运行所使用 CPU总时间的百分比。

    %iowait：显示用于等待I/O操作占用 CPU总时间的百分比。

    %steal：管理程序(hypervisor)为另一个虚拟进程提供服务而等待虚拟 CPU 的百分比。

    %idle：显示 CPU空闲时间占用 CPU总时间的百分比。

    **P.S：**

    1.若 %iowait的值过高，表示硬盘存在I/O瓶颈

    2.若 %idle的值高但系统响应慢时，有可能是 CPU等待分配内存，此时应加大内存容量

    3.若 %idle的值持续低于1，则系统的 CPU处理能力相对较低，表明系统中最需要解决的资源是 CPU。

    - **I/O和传送速率监控**    
    >`# sar -b 5 10`

        每5s采样一次，连续采样10次，报告缓冲区的使用情况

    输出项说明：

    tps：每秒钟物理设备的 I/O传输总量

    rtps：每秒钟从物理设备读入的数据总量

    wtps：每秒钟向物理设备写入的数据总量

    bread/s：每秒钟从物理设备读入的数据量，单位为块/s

    bwrtn/s：每秒钟向物理设备写入的数据量，单位为块/s

    - **网络丢包情况:**

    >`# sar -n DEV 2 10`

    输出项说明：
    IFACE：LAN接口

    rxpck/s：每秒钟接收的数据包

    txpck/s：每秒钟发送的数据包

    rxbyt/s：每秒钟接收的字节数

    txbyt/s：每秒钟发送的字节数

    rxcmp/s：每秒钟接收的压缩数据包

    txcmp/s：每秒钟发送的压缩数据包

    rxmcst/s：每秒钟接收的多播数据包

    >`# sar -n EDEV 2 10`
    
    输出项说明：

    IFACE：LAN接口

    rxerr/s：每秒钟接收的坏数据包
    txerr/s：每秒钟发送的坏数据包

    coll/s：每秒冲突数

    rxdrop/s：因为缓冲充满，每秒钟丢弃的已接收数据包数

    txdrop/s：因为缓冲充满，每秒钟丢弃的已发送数据包数

    txcarr/s：发送数据包时，每秒载波错误数

    rxfram/s：每秒接收数据包的帧对齐错误数

    rxfifo/s：接收的数据包每秒FIFO过速的错误数

    txfifo/s：发送的数据包每秒FIFO过速的错误数

    >`# sar -n SOCK 2 10`

    totsck:使用的套接字总数量

    tcpsck:使用的TCP套接字数量

    udpsck:使用的UDP套接字数量

    rawsck:使用的raw套接字数量

    ip-frag:使用的IP段数量


## 进程管理

 - **ps kill进程:**
    
    - **ps查看进程：**
    >`# ps -ef`

    >`# ps -aux`

    - 查看火狐进程
    >`# ps -ef | grep firfox`

        root      11959   8219 11 16:13 ?        00:00:16 /usr/lib64/firefox/firefox

        root      12219  11959  4 16:14 ?        00:00:02 /usr/lib64/firefox/firefox -contentproc -childID 3 -isForBrowser -boolPrefs 301
        :0| -stringPrefs 287:36;3370bb1d-8351-4b8f-b9e7-291838edd08d| -schedulerPrefs 0001,2 -greomni /usr/lib64/firefox/omni.ja -appomni
        /usr/lib64/firefox/browser/omni.ja -appdir /usr/lib64/firefox/browser 11959 tab

        root      12258  11959  3 16:14 ?        00:00:01 /usr/lib64/firefox/firefox -contentproc -childID 4 -isForBrowser -boolPrefs 301
        :0| -stringPrefs 287:36;3370bb1d-8351-4b8f-b9e7-291838edd08d| -schedulerPrefs 0001,2 -greomni /usr/lib64/firefox/omni.ja -appomni
        /usr/lib64/firefox/browser/omni.ja -appdir /usr/lib64/firefox/browser 11959 tab

        root      12324   9178  0 16:15 pts/0    00:00:00 grep --color=auto firefox

    - 杀死火狐进程
    >`# kill -s 9 11959`
    其中-s 9 制定了传递给进程的信号是９，即强制、尽快终止进程。

    1827则是上面ps查到的火狐的PID。

    - 改进1：
    >`# pgrep firefox`

    xxxx

    >`# kill -s 9 xxxx`

    - 改进2：
    >`# $ pgrep firefox | xargs kill -s 9`

        “xargs kill -s 9”中的xargs命令是用来把前面命令的输出结果（PID）作为“kill -s 9”命令的参数，并执行该命令。“kill -s 9”会强行杀掉指定进程。
    - 改进3：
    >`# kill -s 9 'pgrep firefox' `

    - 改进4：
    >`# pkill -9 firefox`

        说明："-9" 即发送的信号是9，pkill与kill在这点的差别是：pkill无须 “s”，终止信号等级直接跟在 “-“ 后面。
    - 改进5：
    >`# killall -9 firefox`

        说明：killall和pkill是相似的,不过如果给出的进程名不完整，killall会报错。pkill或者pgrep只要给出进程名的一部分就可以终止进程。

## 查看上下文切换
- **vmstat命令：**

    显示虚拟内存状态（“Virtual Memory Statistics”），但是它可以报告关于进程、内存、I/O等系统整体运行状态。

    - **命令格式：**
    >`# vmstat [选项][参数]`

    - **命令选项：**

    -a：显示活动内页  
    -f：显示启动后创建的进程总数  
    -m：显示slab信息  
    -n：头信息仅显示一次  
    -s：以表格方式显示事件计数器和内存状态  
    -d：报告磁盘状态  
    -p：显示指定的硬盘分区状态  
    -S：输出信息的单位

    - **命令参数：**
    
    事件间隔：状态信息刷新的时间间隔  
    次数：显示报告的次数

    - 查看10次 1秒/次
    >`# vmstat 1 10`

        procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
        r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
        2  0 180992  81928     36 432160    2   31   798    75  116  193  2  2 93  3  0
        0  0 180992  81928     36 432160    0    0     0     0   45   77  0  0 100  0  0
        0  0 180992  81928     36 432160    0    0     0     0   30   55  1  0 99  0  0
        0  0 180992  81928     36 432160    0    0     0     0   43   65  0  1 99  0  0
        0  0 180992  81928     36 432160    0    0     0     0   51   75  0  0 100  0  0
        0  0 180992  81928     36 432160    0    0     0     0   46   69  0  1 99  0  0
        0  0 180992  81928     36 432160    0    0     0     0   52   84  0  0 100  0  0
        0  0 180992  81928     36 432160    0    0     0     0   38   55  1  0 99  0  0
        0  0 180992  81928     36 432160    0    0     0     0   50   74  0  0 100  0  0
        0  0 180992  81928     36 432160    0    0     0     0   43   66  1  0 99  0  0

    **Procs（进程）**

    - r: 运行队列中进程数量，这个值也可以判断是否需要增加CPU。（长期大于1）
    - b: 等待IO的进程数量。
    **Memory（内存）**

    - swpd: 使用虚拟内存大小，如果swpd的值不为0，但是SI，SO的值长期为0，这种情况不会影响系统性能。
    - free: 空闲物理内存大小。
    - buff: 用作缓冲的内存大小。
    - cache: 用作缓存的内存大小，如果cache的值大的时候，说明cache处的文件数多，如果频繁访问到的文件都能被cache处，那么磁盘的读IO bi会非常小。
    
    **Swap**

    - si: 每秒从交换区写到内存的大小，由磁盘调入内存。
    - so: 每秒写入交换区的内存大小，由内存调入磁盘。

    注意：内存够用的时候，这2个值都是0，如果这2个值长期大于0时，系统性能会受到影响，磁盘IO和CPU资源都会被消耗。有些朋友看到空闲内存（free）很少的或接近于0时，就认为内存不够用了，不能光看这一点，还要结合si和so，如果free很少，但是si和so也很少（大多时候是0），那么不用担心，系统性能这时不会受到影响的。

    **IO（现在的Linux版本块的大小为1kb）**

    - bi: 每秒读取的块数
    - bo: 每秒写入的块数

    注意：随机磁盘读写的时候，这2个值越大（如超出1024k)，能看到CPU在IO等待的值也会越大。

    **system（系统）**

    - in: 每秒中断数，包括时钟中断。
    - cs: 每秒上下文切换数。

    注意：上面2个值越大，会看到由内核消耗的CPU时间会越大。

    **CPU（以百分比表示）**

    - us: 用户进程执行时间百分比(user time)
    us的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超50%的使用，那么我们就该考虑优化程序算法或者进行加速。

    - sy: 内核系统进程执行时间百分比(system time)
    sy的值高时，说明系统内核消耗的CPU资源多，这并不是良性表现，我们应该检查原因。

    - wa: IO等待时间百分比
    wa的值高时，说明IO等待比较严重，这可能由于磁盘大量作随机访问造成，也有可能磁盘出现瓶颈（块操作）。

    - id: 空闲时间百分比

## 查看IP信息
- **ifconfig命令：**

    ifconfig命令被用于配置和显示Linux内核中网络接口的网络参数。 
    
    - **命令格式：**
    >`# ifconfig [参数]`

    - **命令参数：**

    add<地址>：设置网络设备IPv6的ip地址   
    del<地址>：删除网络设备IPv6的IP地址   
    down：关闭指定的网络设备  
    io_addr：设置网络设备的I/O地址   
    irq：设置网络设备的IRQ  
    media<网络媒介类型>：设置网络设备的媒介类型   
    mem_start<内存地址>：设置网络设备在主内存所占用的起始地址   
    mtu<字节>：设置网络设备的MTU  
    netmask<子网掩码>：设置网络设备的子网掩码   
    tunnel<地址>：建立IPv4与IPv6之间的隧道通信地址   
    up：启动指定的网络设备  
    -broadcast<地址>：将要送往指定地址的数据包当成广播数据包来处理   
    -pointopoint<地址>：与指定地址的网络设备建立直接连线，此模式具有保密功能   
    -promisc：关闭或启动指定网络设备的promiscuous模式  
    IP地址：指定网络设备的IP地址  
    网络设备：指定网络设备的名称

## 查看路由信息
- **route命令：**

    - **命令格式：**
    >`# route [-f] [-p] [Command [Destination] [mask Netmask] [Gateway] [metric Metric]] [if Interface]] `

    - **命令功能：**

    Route命令是用于操作基于内核ip路由表，它的主要作用是创建一个静态路由让指定一个主机或者一个网络通过一个网络接口，如eth0。当使用"add"或者"del"参数时，路由表被修改，如果没有参数，则显示路由表当前的内容。

    - **命令参数：**

        -c 显示更多信息

        -n 不解析名字

        -v 显示详细的处理信息

        -F 显示发送信息

        -C 显示路由缓存

        -f 清除所有网关入口的路由表。 

        -p 与 add 命令一起使用时使路由具有永久性。

        add:添加一条新路由。

        del:删除一条路由。

        -net:目标地址是一个网络。

        -host:目标地址是一个主机。

        netmask:当添加一个网络路由时，需要使用网络掩码。

        gw:路由数据包通过网关。注意，你指定的网关必须能够达到。

        metric：设置路由跳数。

        Command 指定您想运行的命令 (Add/Change/Delete/Print)。 

        Destination 指定该路由的网络目标。 

        mask Netmask 指定与网络目标相关的网络掩码（也被称作子网掩码）。 

        Gateway 指定网络目标定义的地址集和子网掩码可以到达的前进或下一跃点 IP 地址。 

        metric Metric 为路由指定一个整数成本值标（从 1 至 9999），当在路由表(与转发的数据包目标地址最匹配)的多个路由中进行选择时可以使用。 

        if Interface 为可以访问目标的接口指定接口索引。若要获得一个接口列表和它们相应的接口索引，使用 route print 命令的显示功能。可以使用十进制或十六进制值进行接口索引。

    - 查看route信息
    >`# route -n`


## ping/telnet
- ping命令：

    ping 可以测试到目标机器的连通性。Ping域名还可以得出解析IP。评估网络质量。

    >`# ping ipaddress`

- telnet命令：

    telnet 用于远程管理连接主机。同时也是测试目标机器的TCP端口是否开放。如 telnet IP地址 3389 是用来测试目标机器的3389端口是否开放，如果连接失败，可能是防火墙屏蔽，也可能是目标机器没有启用相关远程桌面服务(windows)，或者修改了默认占用3389端口。

    >`# telnet ipaddress`